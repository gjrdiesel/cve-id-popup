/**
 * Highlight keyword inside a DOM element
 */
function highlight(elem) {
  Array.from(elem.childNodes).forEach(child => {
    const keywordRegex = /cve-\d{4}-\d{4,7}/i
    if (child.nodeType !== 3) { // not a text node
      highlight(child);
    } else if (keywordRegex.test(child.textContent)) {
      const frag = document.createDocumentFragment();
      let lastIdx = 0;
      child.textContent.replace(keywordRegex, (match, idx) => {
        const part = document.createTextNode(child.textContent.slice(lastIdx, idx));
        const highlighted = document.createElement('span');
        highlighted.textContent = match;
        highlighted.classList.add('highlight');
        frag.appendChild(part);
        frag.appendChild(highlighted);
        lastIdx = idx + match.length;
      });
      const end = document.createTextNode(child.textContent.slice(lastIdx));
      frag.appendChild(end);
      child.parentNode.replaceChild(frag, child);
    }
  });
}

window.onload = function () {
  highlight(document.body);
};
